<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='notes.css') }}">
    <link rel="icon" href="{{ url_for('static', filename ='favicon.ico')}}">
    <title>Passwords</title>
</head>
<body>

    <div class="notes-submit-container">
        <form class="notes-form" method="POST" action="/encrypt-password">
            <img id="logo_image" src="../static/infinote_logo_trimmed.jpg" alt="A beautiful image">
            <div class="input-container">
                <label for="website">Website</label>
                <input type="text" id="website" name="website" required>
            </div>
            <div class="input-container">
                <label for="user">User</label>
                <input type="text" id="user" name="user" required>
            </div>
            <div class="input-container">
                <label for="password">Password</label>
                <input type="text" id="password" name="password" required>
            </div>
            <button class="submit-btn">Add</button>
        </form>
        <div class="error" >
            {{error_message}}
        </div>
    </div>
    <div class="container">
        <div class="passwords-container" id="pc">

        </div>
    </div>

    <script>
        document.getElementById("logo_image").addEventListener('click',()=>{
            window.location.href="./home";
        })

        let URL_START_INDEX = 8

        window.onload = function(){
            fetch('/api/fetch_passwords',{
                method:"GET",
                cache:"no-cache"
            }).then((response)=>{
                response.json().then((result)=>{
                    let ref = document.querySelector(".passwords-container");
                    result.map((row)=>{
                        ref.innerHTML += `<div class="password-item">
                            <div class="inner-website"><h3>Website</h3><a href="${row[1]}" target="_blank">&nbsp;&nbsp;${row[1].substring(URL_START_INDEX)}</a></div>
                            <div class="inner-user"><h2>Username</h2>&nbsp;&nbsp;${row[2]}</div>
                            <h1>Password</h1> <span class="password">&nbsp;&nbsp;${row[3]}&nbsp;&nbsp;</span>
                            <span class="show-password" onclick="togglePassword(this)">&nbsp;&nbsp;ðŸ”‘&nbsp;</span>
                            </div>`
                    })
                })
            })
        }

        function togglePassword(icon) {
    const passwordField = icon.previousElementSibling; // Use previousElementSibling to target the password span

    if (passwordField.style.display === "none" || passwordField.style.display === "") {
        passwordField.style.display = "inline";
        icon.innerHTML = "ðŸ”’";
    } else {
        passwordField.style.display = "none";
        icon.innerHTML = "&nbsp;&nbsp;ðŸ”‘";
    }
}

    </script>
</body>
</html>

